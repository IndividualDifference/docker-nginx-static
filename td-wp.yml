version: '3.1'

services:
  db:
    image: thedifferent/mariadb:latest
    #build: mariadb
    networks:
      - "local"
      - "dbgui"
    volumes:
      - "db-data:/var/lib/mysql"
    environment:
      - "MYSQL_ROOT_HOST=%"
      - "MYSQL_ROOT_PASSWORD_LOCAL=true"
      - "MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}"
      - "MYSQL_DATABASE=wp"
      - "MYSQL_USER=wordpress"
      - "MYSQL_PASSWORD=${MYSQL_PASSWORD}"
    #resources:
    #  limits:
    #    cpus: '0.3'
    #    memory: 512M
    #  reservations:
    #    cpus: '0.15'
    #    memory: 256M

  wordpress:
    image: thedifferent/wordpress-alpine:gina
    #build: wordpress
    depends_on:
      - "db"
    networks:
      - "local"
      - "rvproxy"
    ports:
      - "${WP_PORT}:80"
    environment:
      - "DB_HOST=db"
      - "DB_NAME=wp"
      - "DB_USER=wordpress"
      - "DB_PASSWORD=${MYSQL_PASSWORD}"
      - "WORDPRESS_SITE_URL=${WP_SITE_URL}"
      - "WP_BACKUP_URL=${WP_BACKUP_URL}"
      - "WP_BACKUP_GIT_REPO=${WP_BACKUP_GIT_REPO}"
      - "WP_BACKUP_GIT_USER=${WP_BACKUP_GIT_USER}"
      - "WP_BACKUP_GIT_PASSWD=${WP_BACKUP_GIT_PASSWD}"
      - "WP_BACKUP_INTERVAL=${WP_BACKUP_INTERVAL}"
    #resources:
    #  limits:
    #    cpus: '0.50'
    #    memory: 1024M
    #  reservations:
    #    cpus: '0.25'
    #    memory: 512M

networks:
  local:
    driver: overlay

  dbgui:
    external:
      name: adminer-net

  rvproxy:
    external:
      name: traefik-net

volumes:
  db-data:
    driver: local
